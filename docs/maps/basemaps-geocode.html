<!doctype html>
<html class="no-js" lang="en">

<head>
    <meta charset="utf-8">
    <title>Base Maps - FCC Design Standards</title>
    <!--#include file="_head-maps.shtml" -->
</head>

<body>
    <!--#include file="_header.shtml" -->
    <div class="pl-container">
        <nav class="docs-sidebar">
            <!--#include file="_sidebar.shtml" -->
        </nav>
        <section class="pl-content">
            <div class="pl-pattern">
                <h3>Anatomy of a map</h3>
                <h4>Map Controls</h4>
                <p>At a minimum, a map should have the following controls or features:</p>
                <div class="table-responsive">
                    <table class="docs-table-mapAnatomy table table-bordered">
                        <thead>
                            <tr>
                                <th>Icon</th>
                                <th>Feature</th>
                                <th>Position on Map</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <div class="clearfix" style="display: inline-block">
                                        <div class="leaflet-control-zoom leaflet-bar leaflet-control">
                                            <a class="leaflet-control-zoom-in" href="#" title="Zoom in">+</a>
                                            <a class="leaflet-control-zoom-out" href="#" title="Zoom out">-</a>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <b>Zoom</b>
                                    <p>description</p>
                                </td>
                                <td>top left</td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="clearfix" style="display: inline-block">
                                        <div class="leaflet-control-zoom leaflet-bar leaflet-control layers">
                                            <a class="leaflet-control-layers-toggle" href="#" title="Layers"></a>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <b>Layers</b>
                                    <p>Maps should have with 3 base layers:</p>
                                    <ul>
                                        <li>street (default)</li>
                                        <li>satellite</li>
                                        <li>terrain</li>
                                    </ul>
                                </td>
                                <td>top left next to zoom</td>
                            </tr>
                            <tr>
                                <td>
                                    <button type="button" class="leaflet-control-layers btn-legend">
                                        <span>
                                                              <span class="icon icon-list"></span>
                                        <span class="sr-only">Map Legend</span>
                                        </span>
                                    </button>
                                </td>
                                <td>
                                    <b>Legend</b>
                                    <p>description</p>
                                </td>
                                <td>bottom left corner above scale</td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="clearfix" style="display: inline-block">
                                        <div class="leaflet-control-scale leaflet-control">
                                            <div class="leaflet-control-scale-line" style="width: 68px;">10 km</div>
                                            <div class="leaflet-control-scale-line" style="width: 52px;">5 mi</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <b>Scale</b>
                                    <p>description</p>
                                </td>
                                <td>bottom left corner</td>
                            </tr>
                            <tr>
                                <td>
                                    &nbsp;
                                </td>
                                <td>
                                    <b>Attribution</b>
                                    <p>Include the map name in the attribution after the organization name (FCC).</p>
                                    <p class="h6"><b>Example</b></p>
                                    <img src="/design-standards/front/images/map-attribution-ex.png" alt="Example attribution" title="Example attribution">
                                </td>
                                <td>bottom right corner</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="pl-preview">
                    <h5 class="docs-hd-example">Example &amp; Code</h5>
                    <div class="search-field input-group">
                        <div class="search__group">
                            <div class="search__input">
                                <div class="input-group">
                                    <div class="input-group-btn">
                                        <button aria-expanded="false" data-toggle="dropdown" class="btn btn-default dropdown-toggle" type="button"><span id="btn-label">Address</span> <span class="caret"></span></button>
                                        <ul id="input-search-switch" role="menu" class="dropdown-menu">
                                            <li><a href="#" data-value="loc">Street</a></li>
                                            <li><a href="#" data-value="latlon-decimal">Coordinates</a></li>
                                        </ul>
                                    </div>
                                    <input id="input-location" class="form-control ui-autocomplete-input ui-corner-all" type="search" placeholder="Enter Address" style="display: block" autocomplete="off">
                                    <div id="input-latlon-decimal" class="form-control" type="search" placeholder="Enter Latlon decimal" style="display: none">
                                        <table id="table-latlon-decimal">
                                            <tbody>
                                                <tr>
                                                    <td>Latitude:
                                                        <input id="latitude" placeholder="41.234567" style="width: 150px; height: 20px; border: solid 1px #eee">
                                                    </td>
                                                    <td width="75"></td>
                                                    <td>Longitude:
                                                        <input id="longitude" placeholder="-91.234567" style="width: 150px; height: 20px; border: solid 1px #eee">
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <span class="input-group-btn" id="span-location-search" style="display: table-cell">                        
                                    <button class="btn__search btn btn-default" type="submit" id="input-loc-search" title="Location Search" data-toggle="tooltip" data-placement="top"><span class="icon icon-search"></span><span class="sr-only">Location Search</span></button>
                                    </span>
                                    <span class="input-group-btn" id="span-latlon-decimal-search" style="display: none">                        
                                    <button class="btn-search btn btn-default" id="input-latlon-decimal-search" title="Decimal Latlon Search" data-toggle="tooltip" data-placement="top"><span class="icon icon-search"></span><span class="sr-only">Decimal Lat/Lon Search</span></button>
                                    </span>
                                </div>
                            </div>
                            <div class="btn__groupLoc">
                                <span class="input-group-btn">  
                                <button class="btn__geoLocation btn btn-default st" title="Get Current Location" data-toggle="tooltip" data-placement="top" id="btn-geoLocation" type="button" data-original-title="Get Current Location">
                                <span class="icon icon-location-arrow"></span><span class="sr-only">Get Current Location</span></button>
                                <button class="btn__nationLocation btn btn-default st" title="Nationwide" data-toggle="tooltip" data-placement="top" id="btn-nationLocation" type="button" data-original-title="Nationwide"><span class="icon icon-globe"></span><span class="sr-only">Nationwide</span></button>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div id="map-container"></div>
                    <div class="docs-codeblock">
                        <ul class="nav nav-pills" role="tablist">
                            <li role="presentation" class="active"><a href="#ex1-html" aria-controls="home" role="tab" data-toggle="tab">HTML</a></li>
                            <li role="presentation"><a href="#ex1-css" aria-controls="profile" role="tab" data-toggle="tab">CSS</a></li>
                            <li role="presentation"><a href="#ex1-js" aria-controls="profile" role="tab" data-toggle="tab">JS</a></li>
                        </ul>
                        <div class="tab-content">
                            <div class="tab-pane active" id="ex1-html" role="tabpanel">
                                <div class="highlight">
                                    <pre class="language-markup">
<code>&lt;div id="map-container"&gt;&lt;/div&gt;</code>
</pre>
                                </div>
                            </div>
                            <div class="tab-pane" id="ex1-css" role="tabpanel">
                                <div class="highlight">
                                    <pre class="language-css">
<code>#map-container { 
  height: 400px; 
  width:100%; 
}</code>
</pre>
                                </div>
                            </div>
                            <div class="tab-pane" id="ex1-js" role="tabpanel">
                                <div class="highlight">
                                    <pre class="language-js">
<code>L.mapbox.accessToken = '<you access token>';
var map = L.mapbox.map('map-container', 'fcc.k74ed5ge', {
        attributionControl: true,
        maxZoom: 15,
        minZoom: 3
    })
    .setView([38.82, -94.96], 4);

baseStreet = L.mapbox.tileLayer('fcc.k74ed5ge').addTo(map);
baseSatellite = L.mapbox.tileLayer('fcc.k74d7n0g');
baseTerrain = L.mapbox.tileLayer('fcc.k74cm3ol');

map.attributionControl.addAttribution('<a href="#void">FCC [Name of Map]</a>');

L.control.layers({
        'Street': baseStreet.addTo(map),a
        'Satellite': baseSatellite,
        'Terrain': baseTerrain
    },
    null, {
        position: 'topleft'
    }
).addTo(map);

L.control.scale({
    position: 'bottomleft'
}).addTo(map);</code>

                                </pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!--#include file="_footer.shtml" -->
    </div>
    <!--#include file="_scripts-footer.shtml" -->
    <script src="https://api.tiles.mapbox.com/mapbox.js/v2.3.0/mapbox.js"></script>
    <script>
    /*L.mapbox.accessToken = 'pk.eyJ1IjoiY29tcHV0ZWNoIiwiYSI6InMyblMya3cifQ.P8yppesHki5qMyxTc2CNLg';
                    var map = L.mapbox.map('map-container', 'mapbox.streets')
                            .setView([40, -74.50], 9);*/

    L.mapbox.accessToken = 'pk.eyJ1IjoiZmNjIiwiYSI6InBiaGMyLU0ifQ.LOmVYpUCFv2yWpbvxDdQNg';
    var map = L.mapbox.map('map-container', 'fcc.k74ed5ge', {
            attributionControl: true,
            maxZoom: 15,
            minZoom: 3
        })
        .setView([38.82, -94.96], 4);

    baseStreet = L.mapbox.tileLayer('fcc.k74ed5ge').addTo(map);
    baseSatellite = L.mapbox.tileLayer('fcc.k74d7n0g');
    baseTerrain = L.mapbox.tileLayer('fcc.k74cm3ol');

    map.attributionControl.addAttribution('<a href="#void">FCC [Name of Map]</a>');

    L.control.layers({
            'Street': baseStreet.addTo(map),
            'Satellite': baseSatellite,
            'Terrain': baseTerrain
        },
        null, {
            position: 'topleft'
        }
    ).addTo(map);

    L.control.scale({
        position: 'bottomleft'
    }).addTo(map);

    var geo_host = "//www.broadbandmap.gov";
    var geo_space = "fcc";

    var clickedCountyLayer;
    var clickedBlockLayer;
    var clickedBlock_fips;
    var countyLayerData = {"features" : []};
    var locationMarker;

    var clickedCountyStyle = {color: "#00f", opacity: 0.5,  fillOpacity: 0.1, fillColor: "#fff", weight: 3};
    var clickedBlockStyle = {color: "#000", opacity: 0.5,  fillOpacity: 0.1, fillColor: "#fff", weight: 3};

    $("#btn-nationLocation").on("click", function() {
        //map.fitBounds(bounds_us);
        map.setView([50, -115], 3);
    });

    $('#btn-geoLocation').click(function(event) {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                var geo_lat = position.coords.latitude;
                var geo_lon = position.coords.longitude;
                var geo_acc = position.coords.accuracy;

                geo_lat = Math.round(geo_lat * 1000000) / 1000000.0;
                geo_lon = Math.round(geo_lon * 1000000) / 1000000.0;
                locationLat = geo_lat;
                locationLon = geo_lon;

                fetchCounty(geo_lat, geo_lon);
                setTimeout(function() {
                    fetchBlock(geo_lat, geo_lon)
                }, 200);

            }, function(error) {
                //alert('Error occurred. Error code: ' + error.code);           
                alert('Sorry, your current location could not be found. \nPlease use the search box to enter your location.');
            }, {
                timeout: 4000
            });
        } else {
            alert('Sorry, your current location could not be found. \nPlease use the search box to enter your location.');
        }

        return false;
    });

    function fetchCounty(lat, lng) {

    //var url = geo_host + "/geoserver/" + geo_space + "/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=" + geo_space + ":bpr_county&maxFeatures=1&outputFormat=text/javascript&cql_filter=contains(geom,%20POINT(" + lng + " " + lat + "))";
    var url = geo_host + "/geoserver/" + geo_space + "/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=" + geo_space + ":bpr_county&maxFeatures=1&outputFormat=json&cql_filter=contains(geom,%20POINT(" + lng + " " + lat + "))" + "&format_options=callback:parseResponse";

    console.log(url)
    //remove county layer
    if (map.hasLayer(clickedCountyLayer)) {
        map.removeLayer(clickedCountyLayer);
    }

    $.ajax({
        type: "GET",
        url: url,
        dataType: "jsonp",
        jsonpCallback: "parseResponse",
        success: function(data) {
        
            if (data.features.length == 0) {
                var county_text = "No county data found at your searched/clicked location.";
                $('#display-county').html(county_text);
                return;
            }
        
            var id = data.features[0].id.replace(/\..*$/, "");
            console.log('county: ' + id); 
            
            if (id != "bpr_county") {
                return;
            }

            if (map.hasLayer(clickedCountyLayer)) {
                map.removeLayer(clickedCountyLayer);
            }
            clickedCountyLayer = L.mapbox.featureLayer(data).setStyle(clickedCountyStyle).addTo(map);
            if (countyLayerData.features.length == 0 || countyLayerData.features[0].properties.county_fips != data.features[0].properties.county_fips) {
                map.fitBounds(clickedCountyLayer.getBounds());
            }
            clickedCountyLayer.on("click", function(e) {
                clickedMap(e);
            });
            
            //get county info
            
            var a = addComma(12345678.998);
            
            var p = data.features[0].properties;
            var urbanunscent = Math.round(p.urbanunscent*100*10) / 10;
            var ruralunscent = Math.round(p.ruralunscent*100*10) / 10;
            var density1 = parseFloat(p.allden);
            if (density1 > 10) {
                var density = Math.round(density1);
            }
            else {
                var density = Math.round(density1 * 100) / 100;
            }
            
            var text = "<span class=\"county-name\">" + p.county_name + ", " + p.state_abbr + "</span><p><p>";
            
            text += "<table width=100% class=\"county-table\">";
            text += "<tr><td>Total Population:</td><td class=\"td-value\"> " + addComma(p.alltotalpop) + "</td></tr>" +
                    "<tr><td>Pop Density (pop/mi<sup>2</sup>):</td><td class=\"td-value\"> " + addComma(density)  + "</td></tr>" +
                    "<tr><td>Per Capita Income: </td><td class=\"td-value\">" + "$" + addComma(p.percapinc) + "</td></tr>" +
                    "<tr><td>Total Pop w/o Access: </td><td class=\"td-value\">" + addComma(p.allunspop) + "</td></tr>" +
                    "<tr><td>Percent Urban Pop w/o Access: </td><td class=\"td-value\">" + urbanunscent + "%</td></tr>" + 
                    "<tr><td>Percent Rural Pop w/o Access: </td><td class=\"td-value\">" + ruralunscent + "%</td></tr>";

                    
            text += "</table>";
            
            $('#display-county').html(text);
            countyLayerData = data;
        
        }
    });

}
    
function fetchBlock(lat, lng) {

    //var url = geo_host + "/geoserver/" + geo_space + "/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=" + geo_space + ":bpr_block_layer&maxFeatures=1&outputFormat=text/javascript&cql_filter=contains(geom,%20POINT(" + lng + " " + lat + "))";
    var url = geo_host + "/geoserver/" + geo_space + "/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=" + geo_space + ":bpr_block_layer&maxFeatures=1&outputFormat=json&cql_filter=contains(geom,%20POINT(" + lng + " " + lat + "))"  + "&format_options=callback:parseResponse";
    
    $.ajax({
        type: "GET",
        url: url,
        dataType: "jsonp",
        jsonpCallback: "parseResponse",
        success: function(data) {
        
            if (data.features.length == 0) {
                var block_text = "No block data found at your searched/clicked location.";
                $('#display-block').html(block_text);
                return;
            }
                
            var id = data.features[0].id.replace(/\..*$/, "");
            if (id != "bpr_block_layer") {
                return;
            }
    
            clickedBlockLayerData = data;
            
            var block_fips = data.features[0].properties.block_fips;
            clickedBlock_fips = block_fips;
            
            if (map.hasLayer(clickedBlockLayer)) {
                map.removeLayer(clickedBlockLayer);
            }
            clickedBlockLayer = L.mapbox.featureLayer(clickedBlockLayerData).setStyle(clickedBlockStyle).addTo(map);

            //map.fitBounds(clickedBlockLayer.getBounds());
            clickedBlockLayer.on("click", function(e) {
            clickedMap(e);
            });
            setLocationMarker(locationLat, locationLon);
            
            var url = geo_host + "/geoserver/" + geo_space + "/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=" + geo_space + ":bpr_block_info&maxFeatures=100&outputFormat=text/javascript&cql_filter=block_fips='" + block_fips + "'";
            var url = geo_host + "/geoserver/" + geo_space + "/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=" + geo_space + ":bpr_block_info&maxFeatures=100&outputFormat=json&cql_filter=block_fips='" + block_fips + "'" + "&format_options=callback:parseResponse";

            }
    });
    
}

function setLocationMarker(lat, lon) {
    if (map.hasLayer(locationMarker)) {
        map.removeLayer(locationMarker);
    }
    locationMarker = L.marker([lat, lon],{title: ""}).addTo(map);
    locationMarker.on("click", function(e) {
    zoomToBlock(e);
    });
}

function addComma(a) {
    var a = "" + a;
    if (a.length == 0) {
    return a;
    }

    var decimal_part = "";
    var integer_part = a;
    if (a.match(/\./)) {
    integer_part = a.split(".")[0];
    decimal_part = a.split(".")[1];
    }

    var len = integer_part.length;
    var str = "";
    for (var i = 0; i < len; i++) {
    if ((len - i -1) % 3 == 0 && (len - i -1) > 0) {
    str += integer_part[i] + ",";
    } 
    else {
    str += integer_part[i];
    }
    }

    var ret = str;
    if (decimal_part != "") {
    var ret = str + "." + decimal_part
    }

    return ret;
}


    </script>
</body>

</html>
